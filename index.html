<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>MMP MinTug</title>
  <link rel="manifest" href="manifest.webmanifest" />
  <link rel="icon" href="icons/icon-192.png" alt="" />
  <meta name="theme-color" content="#0B3C5D" />
  <link rel="stylesheet" href="styles.css" />

  <!-- Inline additions: Legal button + modal popup styling -->
  <style>
    /* =========================
       LEGAL BUTTON (AMBER)
       ========================= */
    .legalBtn {
      width: 100%;
      padding: 14px 16px;
      border-radius: 14px;
      border: none;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: transform 0.1s ease, box-shadow 0.1s ease, opacity 0.15s ease;
    }

    .legalBtn.primary {
      background: linear-gradient(135deg, #F4B400, #E09B00);
      color: #2b1c00;
      box-shadow: 0 4px 10px rgba(0,0,0,0.25);
    }

    .legalBtn.primary:hover {
      opacity: 0.95;
    }

    .legalBtn.primary:active {
      transform: translateY(1px);
    }

    .legalBtn.secondary {
      background: #eee;
      color: #333;
    }

    /* =========================
       MODAL OVERLAY
       ========================= */
    .modalOverlay {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.55);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 9999;
      padding: 14px; /* helps on very small screens */
    }

    .modalOverlay.active {
      display: flex;
    }

    /* =========================
       MODAL CARD
       ========================= */
    .modalCard {
      background: #ffffff;
      width: 92%;
      max-width: 520px;
      max-height: 85vh;
      border-radius: 16px;
      display: flex;
      flex-direction: column;
      box-shadow: 0 12px 30px rgba(0,0,0,0.35);
      overflow: hidden;
    }

    .modalTitle {
      padding: 16px;
      font-size: 16px;
      font-weight: 700;
      border-bottom: 1px solid #eee;
      margin: 0;
    }

    .modalBody {
      padding: 16px;
      font-size: 13px;
      line-height: 1.45;
      overflow-y: auto;
    }

    .modalBody p {
      margin: 0 0 12px 0;
    }

    .modalActions {
      padding: 12px 16px;
      border-top: 1px solid #eee;
    }
  </style>
</head>
<body>
  <div class="app">
    <header class="header">
      <div class="brand">
        <img class="logo" src="icons/icon-192.png" alt="App icon" />
        <h1 class="title">MMP MinTug</h1>
      </div>

      <div class="controls">
        <div class="row">
          <button id="btnBerth" class="chip chip-selected" type="button">Berthing</button>
          <button id="btnUnberth" class="chip" type="button">Unberthing</button>
        </div>

        <label class="field">
          <span class="label">Jetty / Location</span>
          <select id="locationSelect" class="input"></select>
        </label>

        <label class="field">
          <span class="label">LOA (m)</span>
          <input id="loaInput" class="input" inputmode="decimal" placeholder="e.g. 280" />
        </label>

        <button id="calcBtn" class="primary" type="button">Calculate</button>

        <div id="error" class="error" role="alert" aria-live="polite"></div>
      </div>
    </header>

    <main class="results" id="results">
      <div id="emptyState" class="muted">
        Select Berth, Choose Berthing or Unberthing, Enter LOA and press <b>Calculate</b>.
      </div>

      <section id="resultCard" class="card hidden" aria-live="polite">
        <div class="resultTop">
          <div class="resultLabel">Required tugs</div>
          <div id="tugsOut" class="tugs">—</div>
        </div>

        <div class="kv">
          <div class="k">LOA Group</div>
          <div id="bandOut" class="v">—</div>
        </div>

        <div class="block">
          <div class="blockTitle">Notes or Exceptions</div>
          <div id="ruleOut" class="blockBody muted">—</div>
        </div>

        <div class="block">
          <div class="blockTitle">Additional notes</div>
          <div id="notesOut" class="blockBody muted">—</div>
        </div>
      </section>

      <div class="footer">
        <hr />

        <!-- CHANGED: Legal-looking button that opens a modal popup -->
        <button
          id="openDisclaimer"
          class="legalBtn primary"
          type="button"
        >
          More information and Disclaimer, please read
        </button>
      </div>
    </main>
  </div>

  <!-- LEGAL DISCLAIMER MODAL (hidden until button press) -->
  <div id="disclaimerModal" class="modalOverlay" aria-hidden="true">
    <div class="modalCard" role="dialog" aria-modal="true" aria-labelledby="disclaimerTitle">
      <h2 id="disclaimerTitle" class="modalTitle">
        Important Information & Disclaimer
      </h2>

      <div class="modalBody">
        <p>
          Whilst the Malta Maritime Pilots Co-Operative Ltd has endeavoured to ensure that the material supplied is suitable and correct at the date of publication, the Malta Maritime Pilots Co-Operative Ltd. accepts no liability for any damage or loss of any nature arising from the use of this app or any information contained within it.
        </p>

        <p>
          The material supplied is used entirely at the user’s own risk and the information or diagrams may not be reproduced without the developer's written consent.
        </p>

        <p>
          The information contained in this app has to be read and construed in conjunction with the applicable notice to mariners at that particular time of use.
        </p>
      </div>

      <div class="modalActions">
        <button id="closeDisclaimer" class="legalBtn secondary" type="button">
          Close
        </button>
      </div>
    </div>
  </div>

  <script src="app.js"></script>

  <!-- Modal behaviour: open/close, close on overlay click, close on ESC -->
  <script>
    (function () {
      const openBtn = document.getElementById('openDisclaimer');
      const modal = document.getElementById('disclaimerModal');
      const closeBtn = document.getElementById('closeDisclaimer');

      if (!openBtn || !modal || !closeBtn) return;

      const openModal = () => {
        modal.classList.add('active');
        modal.setAttribute('aria-hidden', 'false');
        // Focus close button for accessibility
        closeBtn.focus();
      };

      const closeModal = () => {
        modal.classList.remove('active');
        modal.setAttribute('aria-hidden', 'true');
        // Return focus to the opener
        openBtn.focus();
      };

      openBtn.addEventListener('click', openModal);
      closeBtn.addEventListener('click', closeModal);

      // Click outside modal closes it
      modal.addEventListener('click', (e) => {
        if (e.target === modal) closeModal();
      });

      // ESC closes modal
      document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape' && modal.classList.contains('active')) {
          closeModal();
        }
      });
    })();
  </script>

  <script>
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('./service-worker.js');
    }
  </script>
</body>
</html>